# Release v2.17.0 - Daemon Modes, Bug Report Generator, Priority Crash Fix

**Release Date:** 2026-02-27
**Type:** Minor Release

## Summary

v2.17.0 introduces runtime-mutable daemon modes with an "unattended" mode for long-running operations, a comprehensive bug report generator for streamlined triage, and a defence-in-depth fix for a priority comparison crash. This release also removes the unused OrchestratorOnlyHandler (dead code, never enabled in any configuration).

## Highlights

- **Daemon Modes System** — Switch between "default" and "unattended" modes at runtime. Unattended mode blocks all Stop events, preventing accidental daemon shutdown during long-running operations. Full CLI (`get-mode`/`set-mode`), IPC, and `/mode` skill support.
- **Bug Report Generator** — New `bug-report` CLI subcommand generates structured markdown reports with daemon version, system info, status, configuration, handlers, logs, environment, and health summary. Works even when daemon is not running. Accessible via CLI and `/hooks-daemon bug-report` skill.
- **Priority Crash Fix** — Fixed `TypeError` when a handler has `priority=None` in config. Defence-in-depth across four layers: config validation, registry skip, chain sort fallback, and project loader validation.

## Changes

### Added

- **Daemon Modes System**: Runtime-mutable operating modes with "unattended" mode that blocks Stop events, preventing accidental daemon shutdown during unattended operations. Includes full IPC support (`get_mode`/`set_mode` actions), controller integration, CLI commands (`get-mode`/`set-mode`), and `/mode` skill for interactive mode management.
- **Restart Mode Preservation Advisory**: New advisory that detects when daemon modes are configured and reminds users that `restart` resets modes to defaults, recommending `set_mode` after restart to restore desired modes.
- **CLI Acceptance Test System**: New `generate-playbook` CLI command and `CliAcceptanceTest` infrastructure for non-handler features (daemon modes, CLI commands), extending acceptance testing beyond handler-only coverage.
- **Priority.DEFAULT Constant**: New named constant (`Priority.DEFAULT = 50`) as single source of truth for the default handler priority value.
- **Bug Report Generator**: New `bug-report` CLI subcommand that generates comprehensive structured markdown reports with daemon version, system info, daemon status, configuration, loaded handlers, recent logs, environment variables, and health summary. Works gracefully when daemon is not running. Accessible via CLI (`bug-report "description"`) and skill (`/hooks-daemon bug-report`).

### Fixed

- **NoneType Priority Comparison Crash**: Fixed `TypeError: '<' not supported between instances of 'NoneType' and 'int'` when a handler has `priority=None`. Defence-in-depth fix across four layers: validator rejects `priority: null` in config, registry skips None priority override, chain sort applies default before sorting, and project loader validates priority post-instantiation.
- **Hedging Language Detector Misses Standalone Adverbs**: Fixed hedging language detector failing to match standalone hedging adverbs (e.g., "probably", "maybe") that weren't part of longer phrases.

### Removed

- **OrchestratorOnlyHandler**: Removed dead code handler that was never enabled in any configuration, superseded by upstream Claude Code delegate mode. This is NOT a breaking change — no user configuration references this handler.

## Upgrade Instructions

No breaking changes. Standard upgrade procedure applies.

**Option 1: Using the /hooks-daemon skill (recommended):**

```bash
/hooks-daemon upgrade
```

**Option 2: Manual upgrade:**

```bash
cd .claude/hooks-daemon
git fetch --tags
git checkout v2.17.0
untracked/venv/bin/pip install -e .
untracked/venv/bin/python -m claude_code_hooks_daemon.daemon.cli restart
```

**Option 3: Scripted upgrade:**

```bash
cd .claude/hooks-daemon
./scripts/upgrade_version.sh v2.17.0
```

## New CLI Commands

### bug-report

```bash
# Generate bug report with description
python -m claude_code_hooks_daemon.daemon.cli bug-report "description of issue"

# Save to specific file
python -m claude_code_hooks_daemon.daemon.cli bug-report "issue" -o /tmp/report.md

# Print to stdout
python -m claude_code_hooks_daemon.daemon.cli bug-report "issue" -o -
```

### get-mode / set-mode

```bash
# Check current mode
python -m claude_code_hooks_daemon.daemon.cli get-mode

# Switch to unattended mode
python -m claude_code_hooks_daemon.daemon.cli set-mode unattended

# Return to default mode
python -m claude_code_hooks_daemon.daemon.cli set-mode default
```

## Installation

For new installations, see [CLAUDE/LLM-INSTALL.md](../CLAUDE/LLM-INSTALL.md).

## Comparison

Full diff: https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.16.1...v2.17.0
