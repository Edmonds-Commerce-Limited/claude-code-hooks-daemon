# Release v2.14.0 - User Skill System & Breaking Changes Lifecycle

**Release Date:** 2026-02-18
**Type:** Minor Release

## Summary

This minor release introduces a major new user-facing feature: the `/hooks-daemon` skill system that provides convenient CLI access to daemon operations directly from Claude Code. Additionally, this release includes comprehensive breaking changes lifecycle infrastructure to prevent upgrade issues, critical bug fixes for plugin handler loading, and enhanced FAIL FAST enforcement throughout the codebase.

## Highlights

- **ðŸŽ¯ NEW: /hooks-daemon User Skill** - Single skill with 7 subcommands (upgrade, health, dev-handlers, logs, status, restart, handlers) deployed to user projects
- **ðŸ”„ Breaking Changes Lifecycle** - Complete infrastructure preventing upgrade issues with historical guides, automated detection, and smart validation
- **ðŸš¨ CRITICAL BUG FIX: Plugin Handler Suffix** - Fixed silent failure of plugin handlers with "Handler" suffix
- **âš¡ FAIL FAST Enforcement** - Project handlers (TIER 1) always crash on errors; no silent failures
- **ðŸ“š Comprehensive Documentation** - 1,600-line Plan Workflow guide, separate Plans vs Workflows docs
- **âœ… Test Coverage: 95.2%** - Exceeded minimum requirement with comprehensive improvements
- **ðŸ“Š Effort Level Signal Bars** - Status line now displays â–Œâ–Œâ–Œ effort bars matching Claude Code's UI

## Changes

### Added

#### NEW: /hooks-daemon User Skill (Plan 00061)

**What it is:** A user-facing skill deployed to `.claude/skills/hooks-daemon/` during installation that provides convenient CLI access to all daemon operations.

**Subcommands:**
- `/hooks-daemon upgrade [version]` - Upgrade daemon (auto-detect latest, specific version, or force reinstall)
- `/hooks-daemon health` - Comprehensive health check (status, config validation, handler loading, logs analysis, DEGRADED MODE recovery)
- `/hooks-daemon dev-handlers` - Scaffold project-level handlers with full TDD workflow guidance and event type templates
- `/hooks-daemon logs` - View daemon logs with filtering
- `/hooks-daemon status` - Check daemon status
- `/hooks-daemon restart` - Restart daemon
- `/hooks-daemon handlers` - List all loaded handlers

**Documentation included:**
- Main skill routing documentation (SKILL.md)
- Upgrade guide with version strategies (upgrade.md)
- Health check guide with troubleshooting (health.md)
- Project handler development guide (dev-handlers.md)
- Troubleshooting reference (references/troubleshooting.md)

**Deployment:**
- Skills packaged WITH daemon (not separate distribution)
- Automatically deployed during installation (install_version.sh Step 10)
- Refreshed during upgrades (upgrade_version.sh Step 13)
- Version-aligned with daemon automatically

**Enhanced Error Messages:**
- Better error formatting for plugin handler abstract method violations
- Clear guidance for v2.13.0 breaking changes (missing get_acceptance_tests())
- Matches DEGRADED MODE clarity pattern

**Commits:** bd3eb72, dda0dcc, 7fc9415, d18fb50, 649d6d4, 37a0b52, ab73b82, a6222fe

#### Breaking Changes Lifecycle Infrastructure (Plan 00062)

**Problem Solved:** Users upgrading v2.10.1 â†’ v2.13.0 encountered unknown handler errors with no upgrade guidance. Handlers were removed in v2.11.0 and renamed in v2.12.0 without migration documentation.

**Solution Components:**

1. **Historical Upgrade Guides** (Phase 1):
   - v2.10â†’v2.11: Handler removals (validate_sitemap, remind_validator)
   - v2.11â†’v2.12: Handler rename (validate_eslint_on_write â†’ lint_on_edit)
   - v2.12â†’v2.13: Safe upgrade (no breaking changes)
   - Full migration guides with scripts and verification

2. **Automated Detection** (Phase 2):
   - RELEASING.md Step 6.5: New blocking gate scanning for breaking changes
   - Release agent automatically detects removals/renames/BREAKING markers
   - Generates upgrade guide templates with pre-filled detected changes
   - Blocks release if guide missing or incomplete

3. **Smart Upgrade Validation** (Phases 3-5):
   - **breaking_changes_detector.py**: Parses CHANGELOG.md for breaking change markers (14 tests)
   - **upgrade_compatibility.py**: Validates user config against target version handlers (13 tests)
   - **config_diff_analyzer.sh**: Bash script comparing handler names with fuzzy rename detection
   - Pre-upgrade compatibility check (blocks if incompatibilities found unless --force)
   - Config merge warnings during upgrade
   - Interactive upgrade guide reading enforcement (with --skip-reading-confirmation for CI)

4. **Release Notes Format** (Phase 6):
   - BREAKING CHANGES sections in release notes template
   - Relative links to upgrade guides
   - Examples from v2.11.0 and v2.12.0

5. **Testing & Documentation** (Phase 7):
   - 27 new unit tests (all passing)
   - Updated CLAUDE/LLM-UPDATE.md with breaking changes detection
   - Updated CONTRIBUTING.md with upgrade guide creation requirements

**Three Safety Gates:**
1. **Before upgrade**: Pre-upgrade compatibility check
2. **During upgrade**: Breaking changes warnings with migration hints
3. **After upgrade**: Migration notes file for reference

**Total Impact:** 5,842+ lines of code/documentation, 25 new files, 27 tests

**Commits:** aac0f3e, d5b002b, 0454d9e, 5205851, c94af3e, d0094ce, 19f65af

#### Test Coverage Improvements

**Coverage increased from 94.89% to 95.2%** (+0.31%)

- Core module and handler test coverage improvements
- Protocol and strategy test coverage enhancements
- ImportError tests for input_schemas.py (100% coverage)
- Edge case tests for router.py (100% coverage)
- Unknown extension tests for tdd_enforcement.py (95.24% coverage)
- Protocol isinstance tests for TDD, QA Suppression, and Lint strategies
- Lazy import tests for lint module
- Ellipsis exclusion in pyproject.toml for Protocol stub methods

**Commits:** b8eeb89, bb364a7

#### Release Workflow State Management

Release process now uses workflow state files for compaction resilience.

**Features:**
- State tracking for 14 release phases
- Enables WorkflowStatePreCompactHandler to save state before compaction
- WorkflowStateRestorationHandler restores state on resume
- State files: `./untracked/workflow-state/release/state-release-TIMESTAMP.json`

**14 Release Phases:**
1. Pre-Release Validation
2. Version Detection
3. Version Updates
4. Changelog Generation
5. Release Notes Creation
6. Breaking Changes Detection
7. Upgrade Guide Generation
8. Upgrade Guide Verification Gate (BLOCKING)
9. QA Verification Gate (BLOCKING)
10. Acceptance Testing Gate (BLOCKING)
11. Opus Documentation Review
12. Commit & Push
13. Tag & GitHub Release
14. Verification & Cleanup

**Commit:** 5be1cf0

#### Comprehensive Plan Workflow Documentation

**New `docs/PLAN_WORKFLOW.md`** (1,600 lines, 41KB)

Complete guide to structured planning with numbered folders, applicable to any software project.

**10 Major Sections:**
- Philosophy: Why structured planning matters
- Core concepts: Numbered folders, lifecycle, co-location
- Handler support: 5 handlers documented with configuration
- Setup guide: From zero to first plan
- Customization: Adapt to your project needs
- Best practices: Task writing, status updates, completion checklists
- Integration: Git, issue trackers, CI/CD
- Examples: Three detailed real-world scenarios (feature, refactoring, bug fix)
- FAQ: Common questions
- Project-agnostic design

**Also Updated:**
- README.md: Added "Documentation" section with links
- CLAUDE.md: Added Plan Workflow reference with TL;DR

**Commit:** 15e3591

#### Error Hiding Audit Script (Plan 00063 Phase 2)

Created AST-based audit tool to detect silent error patterns throughout codebase.

**Detects:**
- Silent try/except/pass
- Silent try/except/continue
- Return None on errors
- Log-and-continue patterns
- Bare except clauses

**Audit Results:** 93 violations found across 27 files
- 51 log-and-continue (High severity)
- 21 return-none-on-error (High severity)
- 15 silent-pass (Critical severity)
- 6 silent-continue (Medium severity)

**Finding:** Error hiding is a SYSTEMIC problem requiring comprehensive fix.

**Documentation:** Findings in `untracked/error-hiding-audit-20260217.md`

**Commit:** 7eaf65d

#### Effort Level Signal Bars in Status Line

Added visual effort level indicator to the status line using â–Œâ–Œâ–Œ bars matching Claude Code's own UI.

**Features:**
- Bars display for all models (active = orange, inactive = grey)
- Enhanced display for Claude 4+ models
- Uses exact â–Œâ–Œâ–Œ character matching Claude Code's effort UI

**Commits:** 6ab6e70, 3fca72c

### Changed

#### FAIL FAST Enforcement (Plan 00063)

**Three-Tier Architecture:**
- **TIER 1**: Project handlers (user-written) - ALWAYS crash on errors
- **TIER 2**: Library handlers (built-in) - Strict mode controlled
- **TIER 3**: Logging/cleanup - Always graceful (not yet implemented)

**Project Handlers (TIER 1) - Always Crash:**

Changed ProjectHandlerLoader return type from `Handler | None` to `Handler` (no graceful failure).

**All errors now raise RuntimeError immediately:**
- File not found: RuntimeError
- Import/syntax errors: RuntimeError
- No Handler class found: RuntimeError
- Multiple Handler classes: RuntimeError
- Instantiation failure: RuntimeError

**Test Updates:**
- Updated 8 tests to expect RuntimeError instead of None
- Moved error fixtures to separate directory (`project_handlers_error_cases/`)
- Updated pyproject.toml Black/Ruff/MyPy exclusions for new directory

**CLI Integration:**
- `cmd_validate_project_handlers()` wraps load_handler_from_file() in try/except
- Catches RuntimeError and reports gracefully during validation
- Maintains validation workflow while enforcing TIER 1

**Commits:** ef650d3, 887f52c

**Library Handlers (TIER 2) - Strict Mode Controlled:**

ConfigValidator.get_available_handlers() now accepts strict_mode parameter:
- In `strict_mode=True`: CRASH on handler discovery import errors
- In `strict_mode=False`: Log warning and continue gracefully

**New DRY Utility** (`utils/strict_mode.py`):
- `handle_tier2_error()`: Helper for TIER 2 error handling (crash in strict, log in non-strict)
- `crash_in_strict_mode()`: Helper for detected error conditions
- 7 comprehensive tests

**Refactored Modules:**
- server.py: Use handle_tier2_error() in _get_input_validator() (8 lines â†’ 6 lines)
- validator.py: Use handle_tier2_error() for handler import errors

**Commit:** 5a9977b, 99eeee7

**Plugin Loading FAIL FAST:**

Daemon CRASHES if configured plugins can't be loaded (not warns):
- PluginLoader: CRASH if configured plugin can't be loaded
- DaemonController: CRASH if handler can't be matched to config
- DaemonController: CRASH if event_type is invalid

**Why FAIL FAST:**
- Users have ZERO indication their protection is down with warnings
- Silent failures violate core engineering principles
- Better to crash and force investigation than run unprotected

**Commits:** ef650d3

#### Documentation Structure

**Separated Plans from Workflows:**

Plans and Workflows are two completely different concepts that were incorrectly conflated.

**Plans (docs/PLAN_SYSTEM.md):**
- Numbered folders (00001-) for tracking development work
- Lifecycle: Not Started â†’ In Progress â†’ Complete (moved to Completed/)
- Optional handlers: markdown_organization, plan_completion_advisor

**Workflows (docs/WORKFLOWS.md):**
- Repeatable processes (release, qa-skill) that survive compaction through state files
- State files: `./untracked/workflow-state/{workflow-name}/`
- Required handlers: workflow_state_pre_compact, workflow_state_restoration

**Changes:**
- Renamed `docs/PLAN_WORKFLOW.md` â†’ `docs/PLAN_SYSTEM.md`
- Created new `docs/WORKFLOWS.md` documenting workflow concept properly
- Updated README.md to list both docs separately
- Updated CLAUDE.md to clearly distinguish the two concepts
- Removed incorrect WorkflowStatePreCompactHandler/RestorationHandler references from Plan System docs

**Commit:** 8c4c88b

#### MarkdownOrganizationHandler

Added support for `src/claude_code_hooks_daemon/skills/` directory:
- Enables writing SKILL.md and supporting docs during skill development
- Skills are packaged with daemon (not deployed separately)

**Commit:** dda0dcc

### Fixed

#### CRITICAL: Plugin Handler Suffix Bug (Plan 00063 Phase 1)

**Problem:** Plugin handlers with "Handler" suffix silently skipped with warning, daemon ran unprotected.

**Root Cause:** Asymmetry between PluginLoader.load_handler() (correctly handles suffix) and DaemonController._load_plugins() (only checked base class name without suffix).

**Example:**
- Plugin file: `my_plugin.py` with class `MyPluginHandler`
- PluginLoader.load_handler(): Successfully loads MyPluginHandler
- DaemonController._load_plugins(): Only checks for "MyPlugin" in config, misses "MyPluginHandler"
- Result: Handler silently skipped with log warning

**Fixes Applied:**

1. **DaemonController**: Check both ClassName and ClassNameHandler variants when matching handlers to config
2. **DaemonController**: CRASH if handler can't be matched (not warning)
3. **DaemonController**: CRASH if event_type is invalid (not warning)
4. **PluginLoader**: CRASH if configured plugin can't be loaded (not warning)

**Test Updates:**
- Added `test_load_plugin_with_handler_suffix`: Handler suffix now works correctly
- Added `test_daemon_crashes_on_unmatched_plugin_handler`: FAIL FAST enforcement verified
- Updated 6 tests expecting old buggy behavior (skip/continue) to expect CRASH

**Impact:** Plugin handlers now register correctly regardless of Handler suffix, daemon crashes if misconfigured.

**Commit:** ef650d3

#### Documentation Organization

**Fixed Plans vs Workflows confusion:**
- Previously conflated two separate concepts in single location
- Now properly separated with clear purposes and lifecycles
- Updated cross-references and examples
- Enhanced task breakdown guidance and completion checklist procedures

**Commits:** 8c4c88b, 15e3591

#### Test Bug Fixes

- **test_plugin_daemon_integration.py**: Fixed assertion matching "NOT RUNNING" instead of "Daemon: RUNNING" (commit 99eeee7)
- **test_upgrade_compatibility.py**: Fixed import error `constants.event` â†’ `constants.events` (commit d0094ce)

#### Effort Level Signal Bars Styling

- Fixed bar colours to orange (active) / grey (inactive) matching Claude Code UI (commit 95a6b4d)
- Fixed bar character to â–Œâ–Œâ–Œ matching Claude Code's actual effort UI (commit 0b031b1)

#### Code Formatting

- Applied Black formatting fixes to test_enforcement.py (commit 04a0125)
- Applied Black formatting fixes to test_controller.py (commit 04a0125)
- Removed old error fixture files from project_handlers/ (moved to error_cases/) (commit 04a0125)

## Installation

### New Installations

```bash
cd .claude
git clone -b v2.14.0 https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon.git hooks-daemon
cd hooks-daemon
python3 -m venv untracked/venv
untracked/venv/bin/pip install -e .
untracked/venv/bin/python install.py
```

### Upgrading Existing Installations

**Option 1: Using the new /hooks-daemon skill (if upgrading from v2.14.0+):**

```bash
/hooks-daemon upgrade
```

**Option 2: Manual upgrade:**

```bash
cd .claude/hooks-daemon
git fetch --tags
git checkout v2.14.0
untracked/venv/bin/pip install -e .
untracked/venv/bin/python -m claude_code_hooks_daemon.daemon.cli restart
```

**Option 3: Scripted upgrade:**

```bash
cd .claude/hooks-daemon
./scripts/upgrade_version.sh v2.14.0
```

## Testing

- **Tests:** 5663 passing, 0 failed, 4 skipped
- **Coverage:** 95.2% (exceeded 95% requirement)
- **Type Safety:** MyPy strict mode compliant (0 errors)
- **Security:** Bandit scan clean (0 issues)
- **Linting:** Ruff clean (0 violations)
- **Formatting:** Black compliant (0 files need reformatting)
- **Magic Values:** 0 violations
- **Dependencies:** 0 issues

## Contributors

This release includes commits from:
- Edmonds Commerce team
- Claude Sonnet 4.5 (AI-assisted development)

## Breaking Changes

**No API or configuration breaking changes.** This release is fully backwards compatible with v2.13.0.

**New features are additive only:**
- `/hooks-daemon` skill is deployed automatically during installation/upgrade
- Breaking changes lifecycle infrastructure operates transparently
- Documentation reorganization does not affect functionality

**Behavioral change (FAIL FAST enforcement):**

Plugin loading now crashes instead of silently continuing when:
- A configured plugin handler cannot be loaded
- A loaded handler cannot be matched to config (e.g. name mismatch)
- An invalid event_type is specified in config

**Impact:** If you had latent plugin misconfigurations that were previously silently ignored, the daemon will now crash on startup and report the error clearly. This is intentional - the previous silent failure left the daemon running unprotected without the configured handler active.

**Fix:** Check your `.claude/hooks-daemon.yaml` plugin configuration. Handler class names must match config entries (with or without "Handler" suffix). Correct any mismatches and restart the daemon.

## Full Changelog

**Compare:** https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.13.0...v2.14.0

**All 31 commits since v2.13.0:**
- Plan 00061 (8 commits): /hooks-daemon user skill implementation
- Plan 00062 (6 commits): Breaking changes lifecycle infrastructure
- Plan 00063 (7 commits): FAIL FAST enforcement and plugin handler bug fix
- Plan 00060 (1 commit): Release notes format improvements
- Effort level signal bars (4 commits): Status line visual improvement
- Test coverage improvements (2 commits)
- Documentation improvements (2 commits)
- Release workflow state management (1 commit)

See [CHANGELOG.md](../CHANGELOG.md#2140---2026-02-18) for detailed categorized changes.
