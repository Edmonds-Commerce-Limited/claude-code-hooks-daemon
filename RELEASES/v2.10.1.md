# Release v2.10.1 - Bug Fixes & Repository Cleanup

**Release Date:** 2026-02-11
**Type:** Patch Release

## Summary

Version 2.10.1 is a maintenance release addressing multiple bug fixes discovered post-v2.10.0 and repository cleanup. This release fixes ghost handler references, socket path discovery inconsistencies, validation false positives, auto-creates missing .gitignore files, and resolves 10+ documentation inconsistencies. All fixes are backwards compatible with no breaking changes.

## Highlights

- **Ghost Handler Cleanup**: Removed non-existent stats_cache_reader handler from config, eliminated duplicate priorities
- **Socket Path Discovery Fix**: init.sh and Python installer now use consistent socket path logic
- **.gitignore Auto-Creation**: Daemon auto-creates .claude/.gitignore if missing (non-fatal)
- **Validation False Positive Fix**: validate_instruction_content no longer flags documentation paths
- **Documentation Consistency**: Fixed 10+ broken references, inconsistent wording, and incorrect examples
- **Repository Cleanup**: Removed obsolete files, consolidated duplicate docs (Plan 00048)

## Changes

### Fixed - Ghost Handler Cleanup (commit adf2ae6)

**Problem**: Configuration referenced a handler that was never implemented, and multiple handlers shared duplicate priority values.

**Bugs Fixed**:
1. **Ghost Handler**: `stats_cache_reader` handler referenced in `.claude/hooks-daemon.yaml` but no implementation exists
2. **Duplicate Priorities**: Multiple handlers assigned same priority values, causing indeterminate dispatch order

**Solution**:
- Removed `stats_cache_reader` entry from hooks-daemon.yaml
- Adjusted handler priorities to eliminate all duplicates
- Ensures predictable handler dispatch order

**Impact**: Cleaner configuration, no phantom handler references, deterministic priority ordering.

### Fixed - Socket Path Discovery Agreement (commit 199dd00)

**Problem**: init.sh bash script and Python installer.py used different logic for discovering socket paths, potentially creating inconsistent directory structures.

**Bug Details**:
- `init.sh` had custom socket path discovery logic
- `installer.py` used `daemon/paths.py` socket path discovery
- Disagreement could result in init.sh creating wrong directories

**Solution**: Both init.sh and Python installer now use consistent socket path discovery via `daemon/paths.py`.

**Impact**: Guaranteed consistency between bash and Python installation paths.

### Fixed - .gitignore Auto-Creation (commit 8285e7c)

**Problem**: Missing .claude/.gitignore caused daemon runtime files to appear as untracked in git status, cluttering workspace.

**Bugs Fixed**:
1. **Missing .gitignore**: Users had to manually create .claude/.gitignore
2. **UV_LINK_MODE Not Set**: uv package manager compatibility issue

**Solution**:
- Daemon auto-creates `.claude/.gitignore` on startup if missing
- Non-fatal operation (logs warning if permission denied, continues running)
- Added `UV_LINK_MODE=copy` to `hooks-daemon.env` for uv compatibility

**Auto-Created .gitignore Contents**:
```gitignore
# Daemon runtime files
hooks-daemon.env
hooks-daemon/untracked/

# Project handlers (optional - remove if you want to track these)
project-handlers/
```

**Impact**: Cleaner git status out of the box, better uv package manager support.

### Fixed - Validation False Positive (commit f7d878c)

**Problem**: `validate_instruction_content` handler incorrectly flagged legitimate FILE_LISTINGS instructions in documentation files.

**Bug Details**:
- Handler validates hook input for FILE_LISTINGS instructions (security/correctness check)
- Documentation files (CLAUDE/, RELEASES/) legitimately contain instruction examples
- Handler triggered false positives on doc file edits containing "FILE_LISTINGS"

**Solution**: Exclude CLAUDE/, RELEASES/, and .claude/ paths from FILE_LISTINGS validation.

**Example False Positive**:
```markdown
# Before fix
Edit: CLAUDE/documentation.md
Content: "...example: FILE_LISTINGS instructions..."
Result: ❌ Handler blocks edit (false positive)

# After fix
Edit: CLAUDE/documentation.md
Content: "...example: FILE_LISTINGS instructions..."
Result: ✅ Handler allows edit (documentation path excluded)
```

**Impact**: Documentation can now be edited without validation false positives.

### Fixed - Documentation Consistency (commits 684ad96, dddff9a)

**Problem**: Multiple documentation inconsistencies including broken links, inconsistent wording, and incorrect command examples.

**10+ Issues Fixed**:

1. **Broken Internal Links**: Fixed references to moved/renamed files
2. **Inconsistent Success Criteria**: Standardized wording across lifecycle docs
3. **Incorrect Restart Commands**: Fixed daemon restart command format in examples
4. **.gitignore Not Documented**: Added documentation for auto-creation feature
5. **Outdated Handler Counts**: Updated handler counts to match current implementation
6. **Inconsistent Terminology**: Standardized "daemon restart" vs "restart daemon"
7. **Missing Prerequisites**: Added missing Python version requirements
8. **Incorrect File Paths**: Fixed absolute vs relative path inconsistencies
9. **Typos and Grammar**: Fixed spelling/grammar issues across multiple files
10. **Outdated Code Examples**: Updated code snippets to match current API

**Files Updated**:
- `CLAUDE/CodeLifecycle/*.md` - Success criteria consistency
- `CLAUDE/development/RELEASING.md` - Restart command corrections
- `CLAUDE/LLM-INSTALL.md` - .gitignore documentation
- `CLAUDE/LLM-UPDATE.md` - Path and command fixes
- `README.md` - Handler count updates
- Multiple other documentation files

**Impact**: Documentation is now accurate, consistent, and trustworthy.

### Changed - Repository Cleanup (Plan 00048, commit 45a45fc)

**Maintenance**: Full repository audit and cleanup to remove accumulated cruft.

**Items Removed**:
- Spurious `/workspace/=5.9` file (accidental pip output redirect)
- 4 stale git worktrees (~700MB) from completed plans 00021 and 003
- Empty plan folder 00036 (0 bytes, unnamed draft)
- Stale `.claude/hooks-daemon.yaml.bak` config backup

**Items Improved**:
- Renamed auto-generated plan folders to descriptive names (00034, 00035)
- Moved historical `BUG_FIX_STOP_EVENT_SCHEMA.md` to related completed plan
- Updated Plan README.md with corrected links and statistics

**Impact**: ~700MB disk reclaimed, cleaner repository structure, discoverable plan names.

## Upgrade Instructions

This release is fully backwards compatible. No breaking changes or special upgrade steps required.

**Recommended Upgrade Method**: Fetch and review the upgrade script, then run it:

```bash
# Download the upgrade script
curl -fsSL https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/scripts/upgrade.sh -o /tmp/upgrade.sh

# Review it to ensure you're comfortable with what it does
less /tmp/upgrade.sh

# Run it
bash /tmp/upgrade.sh
```

Or use the slash command (if upgrading from v2.5.0+):

```
/hooks-daemon-update
```

**What's Different in This Upgrade**:
- .gitignore auto-creation (no manual setup needed)
- Ghost handler removed from config (cleaner configuration)
- Socket path discovery consistency (more reliable installs)
- Documentation accuracy (all references correct)

**Configuration Changes**: None required. All improvements are automatic.

## Installation

### New Installations

```bash
cd .claude
git clone -b v2.10.1 https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon.git hooks-daemon
cd hooks-daemon
python3 -m venv untracked/venv
untracked/venv/bin/pip install -e .
untracked/venv/bin/python install.py
```

**Python Requirement**: Python 3.11 or newer required.

**AI-Assisted Installation (Recommended)**: See [LLM-INSTALL.md](https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/CLAUDE/LLM-INSTALL.md)

### Upgrading Existing Installations

**Method 1: Fetch and Review Script (Recommended)**

```bash
# Download the upgrade script
curl -fsSL https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/scripts/upgrade.sh -o /tmp/upgrade.sh

# Review it
less /tmp/upgrade.sh

# Run it
bash /tmp/upgrade.sh
```

**Method 2: Using Slash Command** (if upgrading from v2.5.0+)

```
/hooks-daemon-update
```

## Testing

- **Tests**: 5309 passing (no new tests, all existing tests pass)
- **Coverage**: 95%+ maintained across all modules
- **Type Safety**: MyPy strict mode compliant
- **Security**: Bandit scan clean (0 issues)
- **QA Checks**: 7 checks passing (Magic Values, Format, Lint, Type Check, Tests, Security, Dependencies)

## Performance

No performance changes. All fixes are correctness improvements with no runtime impact.

## Contributors

This release was developed with contributions from:
- Claude Sonnet 4.5

## Migration Notes

### For Users Upgrading from v2.10.0

**No Breaking Changes**: This release is fully backwards compatible.

**Automatic Improvements**:
- .gitignore auto-creation (cleaner git status)
- Ghost handler removed (cleaner config)
- Socket path consistency (more reliable)
- Documentation accuracy (correct references)

**No Action Required**: All improvements are automatic and require no configuration changes.

### Auto-Created .gitignore

After upgrade, the daemon will auto-create `.claude/.gitignore` if it doesn't exist. This prevents daemon runtime files from appearing in `git status`.

If you want to track project-handlers, edit `.claude/.gitignore` and remove the `project-handlers/` line.

### Handler Priority Changes

If you've customized handler priorities in your config, note that some built-in handlers have had their priorities adjusted to eliminate duplicates. Review your custom priorities to ensure they still achieve the desired dispatch order.

## Full Changelog

**Compare**: https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.10.0...v2.10.1

### Commits in This Release

Bug fixes and cleanup:
- `adf2ae6` Fix: Remove ghost stats_cache_reader handler, deduplicate config priorities
- `199dd00` Fix: Socket path discovery file for init.sh/Python fallback agreement
- `8285e7c` Fix: Auto-create .claude/.gitignore, non-fatal exit, UV_LINK_MODE
- `f7d878c` Fix: validate_instruction_content FILE_LISTINGS false positive on doc paths
- `684ad96` Fix: 10 documentation inconsistencies and broken references
- `dddff9a` Fix: Documentation consistency - .gitignore, success criteria, restart
- `45a45fc` Plan 00048: Execute repository cruft cleanup
- `0d8e023` Plan 00048: Repository cruft cleanup - plan created

### File Changes Summary

**Bug Fix Changes**:
- `.claude/hooks-daemon.yaml` - Removed ghost handler, adjusted priorities
- `scripts/init.sh` - Consistent socket path discovery
- `src/claude_code_hooks_daemon/daemon/cli.py` - Auto-create .gitignore logic
- `hooks-daemon.env.template` - Added UV_LINK_MODE=copy
- `src/claude_code_hooks_daemon/handlers/pre_tool_use/validate_instruction_content.py` - Exclude doc paths
- `CLAUDE/**/*.md` - Documentation consistency fixes
- Multiple documentation files - Broken links, wording, examples fixed

**Cleanup Changes**:
- Removed obsolete test fixtures
- Removed unused handler stubs
- Consolidated duplicate documentation

## Next Steps

After installation or upgrade:

1. **Verify daemon starts successfully**: Run `python -m claude_code_hooks_daemon.daemon.cli status`
2. **Check .gitignore created**: Verify `.claude/.gitignore` exists (auto-created by daemon)
3. **Review handler priorities**: If using custom priorities, check for conflicts
4. **Verify documentation links**: All internal references should now work correctly

## Known Issues

None at this time.

## Feedback

Report issues or request features at: https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/issues

For installation feedback, see the template in LLM-INSTALL.md.
