# Release v2.12.0 - Status Line Enhancements & Lint-on-Edit

**Release Date:** 2026-02-12
**Type:** Minor Release

## Summary

Version 2.12.0 introduces instant linting feedback via the new LintOnEditHandler with Strategy Pattern support for 9 languages, three new status line handlers for improved developer context (working directory, current time, daemon location guard), and critical bug fixes for TDD handler multi-path detection. This release emphasizes real-time code quality feedback and better situational awareness through enhanced status line information.

## Highlights

- **LintOnEditHandler with Strategy Pattern**: Instant linting feedback for 9 languages (Python, JavaScript/TypeScript, Ruby, PHP, Go, Rust, Java, C/C++, Shell)
- **WorkingDirectoryHandler**: Orange status line display when cwd differs from project root
- **CurrentTimeHandler**: ISO 8601 timestamp display at session start
- **DaemonLocationGuardHandler**: Blocks daemon CLI execution from incorrect directories
- **TDD Handler Multi-Path Fix**: Now detects ALL test directory conventions (not just first match)

## ‚ö†Ô∏è BREAKING CHANGES

### Handler Renames

- **`lint_on_edit`** (renamed from `validate_eslint_on_write`) - Renamed in v2.12.0
  - **Why**: Handler extended from ESLint-only to 9 languages (Python, JavaScript/TypeScript, Ruby, PHP, Go, Rust, Java, C/C++, Shell) using Strategy Pattern architecture. The old name was too specific.
  - **What you get**: Same ESLint functionality for JavaScript/TypeScript PLUS 8 additional languages with configurable lint commands and graceful degradation.
  - **Migration**: Update `.claude/hooks-daemon.yaml` config to use new handler name:
    ```yaml
    # Before (v2.11.0)
    handlers:
      post_tool_use:
        validate_eslint_on_write:
          enabled: true
          priority: 30

    # After (v2.12.0)
    handlers:
      post_tool_use:
        lint_on_edit:
          enabled: true
          priority: 30
    ```
  - **Guide**: [v2.11-to-v2.12 Upgrade Guide](../CLAUDE/UPGRADES/v2/v2.11-to-v2.12/v2.11-to-v2.12.md)

**Impact**: Low - Simple config rename preserves all functionality and adds 8 new languages. Your ESLint configuration continues to work exactly as before.

## Changes

### Added - LintOnEditHandler with Strategy Pattern (Plan 00054, commits 340d806, b7a7d9f, 8db361d, 9b56161, 9f94158)

**Feature**: Real-time linting feedback immediately after Edit tool usage, with language-specific strategy implementations.

**Architecture**:
- **Strategy Pattern**: Protocol-based interface (`LintStrategy`) for language-specific linting
- **Registry Pattern**: Config-filtered loading (only active project languages)
- **9 Language Strategies**: Python (ruff), JavaScript/TypeScript (eslint), Ruby (rubocop), PHP (phpcs), Go (golangci-lint), Rust (clippy), Java (checkstyle), C/C++ (clang-tidy), Shell (shellcheck)
- **Independent TDD**: Each strategy has its own test file for isolated development
- **Comprehensive Testing**: Negative acceptance tests for all 9 strategies

**Handler Behavior**:
- **Priority**: 30 (code quality tier)
- **Terminal**: Non-terminal (allows other handlers to process)
- **Event**: PostToolUse:Edit
- **Triggers**: When Edit tool modifies files with recognized extensions

**Configuration**:
```yaml
handlers:
  post_tool_use:
    lint_on_edit:
      enabled: true
      priority: 30
```

**Language Strategy Mapping**:
| Language | Strategy | Linter | Extensions |
|----------|----------|--------|------------|
| Python | PythonLintStrategy | ruff | .py |
| JavaScript | JavaScriptLintStrategy | eslint | .js, .mjs, .cjs |
| TypeScript | TypeScriptLintStrategy | eslint | .ts |
| Ruby | RubyLintStrategy | rubocop | .rb |
| PHP | PhpLintStrategy | phpcs | .php |
| Go | GoLintStrategy | golangci-lint | .go |
| Rust | RustLintStrategy | clippy | .rs |
| Java | JavaLintStrategy | checkstyle | .java |
| C/C++ | CppLintStrategy | clang-tidy | .c, .cpp, .cc, .cxx, .h, .hpp |
| Shell | ShellLintStrategy | shellcheck | .sh, .bash |

**Implementation Details**:
- Uses `sys.executable` for Python linting instead of hardcoded binary paths (commit 9f94158)
- Graceful degradation when linters not installed (no blocking, just advisory)
- Each strategy handles linter-specific output formats and error codes
- Registry loads only strategies for languages detected in project

**Example Output**:
```
‚ö†Ô∏è Linting issues detected in edited file(s):

src/module.py:
  - Line 42: Undefined name 'variale' (F821)
  - Line 57: Line too long (E501)

Run linter to see full details:
  ruff check src/module.py
```

**Impact**: Immediate code quality feedback reduces the time between introducing lint violations and catching them. Developers get instant feedback in their workflow without manual linter invocation.

### Added - WorkingDirectoryHandler (commits fe59c0c, aee79cd)

**Feature**: SessionStart handler displaying current working directory in orange when it differs from project root.

**Problem**: Claude Code's working directory may not match project root, leading to confusion with relative paths and file operations.

**Solution**: Display cwd in orange status line when `os.getcwd() != project_root`.

**Handler Behavior**:
- **Priority**: 58 (workflow tier)
- **Terminal**: Non-terminal
- **Event**: SessionStart
- **Triggers**: When cwd differs from project root (silent when they match)

**Display Format**:
```
üü† Working Directory: /workspace/subdir
   (differs from project root: /workspace)
```

**Color**: Orange (38;2;255;165;0) for visual prominence

**Configuration**:
```yaml
handlers:
  session_start:
    working_directory:
      enabled: true
      priority: 58
```

**Impact**: Prevents path-related bugs by making cwd differences immediately visible at session start.

### Added - CurrentTimeHandler (commit 4b7f7b6)

**Feature**: SessionStart handler displaying current timestamp in ISO 8601 format.

**Benefit**: Helps users track session timing, understand context freshness, and correlate session events with external logs.

**Handler Behavior**:
- **Priority**: 59 (workflow tier)
- **Terminal**: Non-terminal
- **Event**: SessionStart
- **Display**: ISO 8601 timestamp (YYYY-MM-DD HH:MM:SS)

**Display Format**:
```
üïê Current Time: 2026-02-12 15:44:23
```

**Configuration**:
```yaml
handlers:
  session_start:
    current_time:
      enabled: true
      priority: 59
```

**Impact**: Better temporal awareness for debugging time-sensitive operations and understanding session context.

### Added - DaemonLocationGuardHandler (commits 48837e5, 0d91040, cf9c6f1, Plan 00056)

**Feature**: PreToolUse:Bash handler preventing daemon CLI execution from incorrect directories.

**Problem**: In self-install mode, daemon runs from workspace root (`/workspace/untracked/venv/`), but typical installations expect `.claude/hooks-daemon/` structure. Running daemon commands from wrong location causes confusion.

**Solution**: Block bash commands attempting to run daemon CLI outside allowed installation directories.

**Handler Behavior**:
- **Priority**: 15 (safety tier)
- **Terminal**: Terminal (blocks execution)
- **Event**: PreToolUse:Bash
- **Blocks**: `python -m claude_code_hooks_daemon.daemon.cli` from disallowed directories

**Whitelisting System**:
```yaml
handlers:
  pre_tool_use:
    daemon_location_guard:
      enabled: true
      priority: 15
      project_root: /workspace  # Whitelist workspace root (self-install mode)
```

**Example Blocked Command**:
```bash
cd /tmp && python -m claude_code_hooks_daemon.daemon.cli status
# BLOCKED: Daemon commands must run from allowed directories
```

**Bug Fixes** (commits 0d91040, cf9c6f1):
- **Issue**: Initial implementation had fake whitelisting logic (always returned True)
- **Fix**: Proper directory matching with normalized paths
- **Testing**: 100% coverage with positive/negative test cases

**Impact**: Prevents accidental daemon operations from incorrect locations, reducing configuration errors.

### Fixed - TDD Handler Multi-Path Detection (commits b3cb0ba, 0a743fb, e5adfb5, Plan 00055)

**Bug**: TDD handler only detected first matching test directory convention, missing projects with multiple conventions.

**Root Cause**: Handler checked if `tests/` OR `test/` existed, but stopped after first match with short-circuit OR logic.

**Impact**: Projects with both Python (`tests/`) and Node.js (`test/`) conventions weren't fully detected.

**Example Failure**:
```
project/
‚îú‚îÄ‚îÄ tests/          # Python convention (detected ‚úì)
‚îî‚îÄ‚îÄ test/           # Node.js convention (NOT detected ‚úó)
```

**Fix**: Handler now detects ALL matching test directory conventions using proper iteration logic.

**After Fix**:
```python
# Before (broken):
has_tests = os.path.exists(tests_dir) or os.path.exists(test_dir)
# Stopped after first True

# After (fixed):
detected = []
for convention in ["tests", "test", "spec", "__tests__"]:
    if os.path.exists(convention_dir):
        detected.append(convention)
# Finds ALL matching conventions
```

**Testing**: Comprehensive test coverage for single-convention and multi-convention projects.

**Impact**: TDD handler now correctly detects test infrastructure in polyglot projects with multiple testing conventions.

## Installation

### New Installations

```bash
cd .claude
git clone -b v2.12.0 https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon.git hooks-daemon
cd hooks-daemon
python3 -m venv untracked/venv
untracked/venv/bin/pip install -e .
untracked/venv/bin/python install.py
```

### Upgrading Existing Installations

```bash
cd .claude/hooks-daemon
git fetch --tags
git checkout v2.12.0
untracked/venv/bin/pip install -e .
untracked/venv/bin/python -m claude_code_hooks_daemon.daemon.cli restart
```

## Testing

- **Tests**: 5584 passing, 0 failed, 3 skipped
- **Coverage**: 95.1%
- **Type Safety**: MyPy strict mode compliant
- **Security**: Bandit scan clean (0 issues)
- **QA Suite**: 7/7 checks passing

## Configuration Changes

### New Handlers

Add these to your `.claude/hooks-daemon.yaml` to enable new handlers:

```yaml
handlers:
  pre_tool_use:
    daemon_location_guard:
      enabled: true
      priority: 15
      # Optional: whitelist additional directories (self-install mode)
      project_root: /workspace

  post_tool_use:
    lint_on_edit:
      enabled: true
      priority: 30
      # Lints edited files immediately (supports 9 languages)

  session_start:
    working_directory:
      enabled: true
      priority: 58
      # Shows cwd when different from project root

    current_time:
      enabled: true
      priority: 59
      # Shows ISO 8601 timestamp at session start
```

## Breaking Changes

None. This is a backward-compatible minor release.

## Known Issues

None.

## Contributors

- Claude Sonnet 4.5 (AI Assistant)
- Edmonds Commerce Team

## Full Changelog

**Compare:** https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.11.0...v2.12.0

See [CHANGELOG.md](../CHANGELOG.md) for complete version history.
