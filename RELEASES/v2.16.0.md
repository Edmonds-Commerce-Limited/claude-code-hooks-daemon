# Release v2.16.0 - Config Migration Advisory, SedBlocker Modes & Bug Fixes

**Release Date:** 2026-02-22
**Type:** Minor Release

## Summary

This minor release delivers two new handler capabilities, a new `/configure` skill, and two targeted bug fixes. The standout addition is the version-aware config migration advisory system, which detects when the active session is running a different daemon version than installed and prompts the user to migrate. SedBlockerHandler gains a `blocking_mode` option so teams can choose between hard-blocking and advisory-warning behaviour. Two correctness bugs are fixed: a race condition in planning mode redirect and false positives in the pipe blocker for grep alternation patterns.

## Highlights

- **Version-aware config migration advisory** - New handler detects version drift between the running session and installed daemon, prompting timely config migration and preventing stale-config surprises after upgrades
- **SedBlockerHandler `blocking_mode` option** - Teams can now configure SedBlocker to issue warnings instead of hard blocks, with full documentation and acceptance test coverage
- **`/configure` skill** - New guided workflow for structured daemon configuration, aligned with the project SSOT documentation standards
- **Plan file race condition fixed** - `plan_completion_advisor` now correctly returns `DENY` after redirecting to planning mode, closing a logic gap that allowed hooks to fall through
- **PipeBlocker false positive fix** - grep alternation patterns (`grep "foo\|bar"`) no longer trigger false positives; whitelist expanded for common safe patterns

## Changes

### Added

- **Version-aware config migration advisory system**: New PostToolUse handler (`version_aware_config_migration`) that detects when the daemon version in the active session differs from the installed daemon version and advises the user to run the config migration tool. Prevents users from running stale configurations after upgrades.
- **`blocking_mode` option for SedBlockerHandler**: SedBlockerHandler now supports a `blocking_mode` configuration option (`block` or `warn`) allowing teams to choose between hard-blocking dangerous sed patterns or issuing an advisory warning. Full docs and acceptance test included.
- **`/configure` skill**: New `/configure` skill enabling structured configuration of the daemon through a guided workflow. Provides a SSOT-aligned approach to setting daemon options.
- **Coverage tests to reach 95.1% threshold**: Additional unit tests added to bring overall test coverage from below threshold to 95.1%, satisfying the mandatory 95% coverage gate.

### Fixed

- **Plan file race condition in planning mode redirect**: `plan_completion_advisor` handler now correctly returns `DENY` after redirecting to planning mode, preventing the hook from falling through to allow when it should be blocking.
- **PipeBlocker false positives on grep alternation patterns**: `pipe_blocker` handler no longer triggers false positives on grep commands using alternation patterns (e.g. `grep "foo\|bar"`). Whitelist expanded to cover common safe pipe-including patterns.

## Upgrade Instructions

No breaking changes. Standard upgrade procedure applies.

**Option 1: Using the /hooks-daemon skill (recommended):**

```bash
/hooks-daemon upgrade
```

**Option 2: Manual upgrade:**

```bash
cd .claude/hooks-daemon
git fetch --tags
git checkout v2.16.0
untracked/venv/bin/pip install -e .
untracked/venv/bin/python -m claude_code_hooks_daemon.daemon.cli restart
```

**Option 3: Scripted upgrade:**

```bash
cd .claude/hooks-daemon
./scripts/upgrade_version.sh v2.16.0
```

## Installation

### New Installations

```bash
cd .claude
git clone -b v2.16.0 https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon.git hooks-daemon
cd hooks-daemon
python3 -m venv untracked/venv
untracked/venv/bin/pip install -e .
untracked/venv/bin/python install.py
```

### Upgrading Existing Installations

See Upgrade Instructions above.

## Testing

- **Tests:** 6379 passing
- **Coverage:** 95.1%
- **Type Safety:** MyPy strict mode compliant (0 errors)
- **Security:** Bandit scan clean (0 issues)
- **Linting:** Ruff clean (0 violations)
- **Formatting:** Black compliant (0 files need reformatting)
- **Magic Values:** 0 violations
- **Dependencies:** 0 issues
- **Shell Scripts:** Shellcheck clean (0 errors, 0 warnings)

## Contributors

This release includes commits from:
- Edmonds Commerce team
- Claude Sonnet 4.6 (AI-assisted development)

## Breaking Changes

No breaking changes. This release is fully backwards-compatible with v2.15.2.

## Full Changelog

**Compare:** https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.15.2...v2.16.0

**9 commits since v2.15.2:**
- `c509430` Add: Coverage tests to reach 95.1% threshold
- `0832a20` Plan 00065: Complete - Version-aware config migration advisory system
- `7011c0a` Add: Version-aware config migration advisory system (Plan 00065)
- `61720e5` Plan 00066: Complete - Fix plan file race condition
- `d1b75d3` Fix: plan file race condition â€” return DENY after planning mode redirect
- `a9011c5` Fix: pipe_blocker false positives on grep alternation patterns and expand whitelist
- `00394a9` Add: /configure skill and SSOT doc improvements
- `fc57698` Add: docs and acceptance test for sed_blocker blocking_mode option
- `02a516a` Add: blocking_mode option to SedBlockerHandler

See [CHANGELOG.md](../CHANGELOG.md#2160---2026-02-22) for the categorised changelog entry.
