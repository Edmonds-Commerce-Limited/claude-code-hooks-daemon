# Release v2.6.0 - Client Installation Safety and Complete Dogfooding

**Release Date:** 2026-02-09
**Type:** Minor Release

## Summary

Version 2.6.0 focuses on improving the client installation experience and ensuring the daemon fully dogfoods its own capabilities. This release adds a comprehensive client installation validation system that prevents configuration issues, introduces a guided upgrade slash command, and enables all handlers in the daemon's own configuration for complete self-testing.

## Highlights

- **Client Installation Safety Validator**: Comprehensive validation system prevents configuration issues in client projects
- **/hooks-daemon-update Slash Command**: Auto-deployed guided upgrade assistance for LLMs
- **Complete Dogfooding Configuration**: All handlers enabled in daemon's own config for comprehensive self-testing
- **Fixed Config Detection**: Proper self-install vs client project mode distinction
- **GitHub-First Upgrade Pattern**: Follows industry best practices (rustup, nvm, homebrew)

## Changes

### Added

- **Client Installation Safety Validator**: Comprehensive validation system for client project installations
  - Pre-install validation ensures no stale configs or runtime files exist
  - Post-install validation verifies correct daemon directory structure
  - Lazy-load imports to avoid dependency issues during installation
  - Prevents handler_status.py path confusion by validating config structure
  - Safety checks validate:
    - No self_install_mode flag in client configs (prevents path confusion)
    - Config is valid YAML with correct structure
    - Stale runtime files are cleaned up (sockets, PIDs)
    - Daemon directory is at correct location

- **/hooks-daemon-update Slash Command**: Auto-deployed during install/upgrade
  - Provides guided LLM assistance for daemon updates
  - Always fetches latest upgrade instructions from GitHub
  - Works for all versions including pre-v2.5.0 installations
  - Ensures upgrade process uses current best practices
  - Simple `/hooks-daemon-update` command available in all client projects

### Changed

- **Upgrade Documentation**: Made GitHub-fetched upgrade script the primary recommended method
  - Follows pattern used by rustup, nvm, homebrew, etc.
  - Ensures latest script with bug fixes and improvements
  - Better rollback and error handling in recent versions
  - Works consistently across all daemon versions

- **Complete Dogfooding Configuration**: Enabled all handlers in daemon's own config
  - Enabled strict_mode at daemon level for FAIL FAST behavior
  - Activated all safety handlers (curl_pipe_shell, pipe_blocker, dangerous_permissions, pip_break_system, sudo_pip, lock_file_edit_blocker, daemon_restart_verifier)
  - Activated all workflow handlers (plan_completion_advisor, task_tdd_advisor, validate_plan_number, plan_time_estimates)
  - Activated all PostToolUse handlers (validate_eslint_on_write, validate_sitemap)
  - Activated all session handlers (workflow_state_restoration, remind_prompt_library, remind_validator)
  - Activated all status handlers (git_repo_name, account_display, thinking_mode, usage_tracking)
  - Ensures daemon catches issues early by using all its own protections

- **Hook Script Regeneration**: Updated all hook scripts to match current installer output
  - Fixed config handler name (hello_world_pre_tool_use)
  - Ensures consistency between generated and committed scripts

### Fixed

- **Config Detection Logic**: Fixed handler_status.py to properly distinguish self-install vs client project mode
  - Previous logic checked if `src/claude_code_hooks_daemon` exists (always true in both scenarios)
  - Now reads config file for self_install_mode flag to determine correct mode
  - Prevents reading wrong config file in client projects
  - All paths dynamically detected without hardcoded assumptions
  - Detection logic:
    - Reads `.claude/hooks-daemon.yaml` in daemon root
    - If `self_install_mode=true` → daemon project
    - Otherwise → client project (`.claude/hooks-daemon/`)

## Upgrade Instructions

This release is backwards compatible. No breaking changes or special upgrade steps required.

**Recommended Upgrade Method**: Use the new GitHub-fetched upgrade script:

```bash
curl -fsSL https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/scripts/upgrade.sh | bash
```

Or use the new slash command (if upgrading from v2.5.0+):

```
/hooks-daemon-update
```

**Configuration Changes**: None required. The new client installation validator runs automatically during install/upgrade.

For version-specific upgrade guides, see `CLAUDE/UPGRADES/` directory.

## Installation

### New Installations

```bash
cd .claude
git clone -b v2.6.0 https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon.git hooks-daemon
cd hooks-daemon
python3 -m venv untracked/venv
untracked/venv/bin/pip install -e .
untracked/venv/bin/python install.py
```

**AI-Assisted Installation (Recommended)**: See [LLM-INSTALL.md](https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/CLAUDE/LLM-INSTALL.md)

### Upgrading Existing Installations

**Method 1: GitHub-Fetched Script (Recommended)**

```bash
cd .claude/hooks-daemon
curl -fsSL https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/scripts/upgrade.sh | bash
```

**Method 2: Slash Command (v2.5.0+ only)**

```
/hooks-daemon-update
```

**Method 3: Local Script**

```bash
cd .claude/hooks-daemon
git fetch --tags
git checkout v2.6.0
untracked/venv/bin/pip install -e .
bash scripts/upgrade.sh
```

**AI-Assisted Upgrade**: See [LLM-UPDATE.md](https://raw.githubusercontent.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/main/CLAUDE/LLM-UPDATE.md)

## Testing

- **Tests:** 4296 passing, 1 skipped
- **Coverage:** 96.68% (exceeds 95% requirement)
- **Type Safety:** MyPy strict mode compliant (0 errors)
- **Security:** Bandit scan clean (0 issues)
- **Linting:** Ruff clean (0 violations)
- **Formatting:** Black compliant

## Quality Assurance

All QA checks passing:

```
========================================
QA Summary
========================================
  Magic Values        : ✅ PASSED
  Format Check        : ✅ PASSED
  Linter              : ✅ PASSED
  Type Check          : ✅ PASSED
  Tests               : ✅ PASSED
  Security Check      : ✅ PASSED

Overall Status: ✅ ALL CHECKS PASSED
```

## Contributors

This release includes contributions from:
- Edmonds Commerce Limited
- Claude Sonnet 4.5 (AI-assisted development)

## Breaking Changes

None. This release is fully backwards compatible with v2.5.0.

## Deprecations

None.

## Known Issues

None.

## Full Changelog

**Compare:** https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.5.0...v2.6.0

For complete details, see [CHANGELOG.md](../CHANGELOG.md#260---2026-02-09)
