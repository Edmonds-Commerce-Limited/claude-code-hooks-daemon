# Release v2.2.1 - Git Permission Tracking Fix

**Release Date:** 2026-01-27
**Type:** Patch Release

## Summary

This patch release fixes a critical installation issue for repositories that use `core.fileMode=false` (common on Windows and some CI environments). The installer now automatically detects this setting and ensures hook files are properly marked as executable in git's index.

## Highlights

- **Git Permission Handling**: Automatic detection and handling of repositories with core.fileMode=false
- **Smart Index Updates**: Installer now updates git index to mark hooks as executable when needed
- **Context-Aware Warnings**: Different instructions for tracked vs untracked files
- **Improved Install Flow**: Better feedback during installation in permission-challenged environments

## Changes

### Fixed
- Fixed git hook executable permissions in repositories with core.fileMode=false
- Enhanced install.py to detect and handle permission tracking settings
- Added auto-update of git index for hook executability
- Added context-specific warnings for tracked vs untracked files

## Technical Details

### Problem
In repositories where `git config core.fileMode` is set to `false`, git doesn't automatically track file permission changes. This meant that hook files created by the installer wouldn't be marked as executable in the git index, causing failures when the repository was cloned or pulled to other machines.

### Solution
The installer now:
1. Detects if core.fileMode=false using `check_git_filemode()`
2. Automatically runs `git update-index --chmod=+x` for hook files
3. Provides context-specific guidance:
   - **Tracked files**: Auto-updates index and prompts for commit
   - **Untracked files**: Shows 3-step manual process
   - **Errors**: Displays fallback instructions

### Files Changed
- `install.py`: Added 133 new lines for permission detection and handling
- `tests/unit/test_version.py`: Fixed version assertion to 2.2.0

## Upgrade Instructions

No special upgrade steps required - this is a bug fix to the installer only.

### Upgrading Existing Installations

```bash
cd .claude/hooks-daemon
git fetch --tags
git checkout v2.2.1
untracked/venv/bin/pip install -e .
untracked/venv/bin/python -m claude_code_hooks_daemon.daemon.cli restart
```

## Installation

### New Installations

```bash
cd .claude
git clone -b v2.2.1 https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon.git hooks-daemon
cd hooks-daemon
python3 -m venv untracked/venv
untracked/venv/bin/pip install -e .
untracked/venv/bin/python install.py
```

## Testing

- **Tests:** 2472 passing
- **Coverage:** 95.01%
- **Type Safety:** MyPy strict mode compliant
- **Security:** Bandit scan clean

## Contributors

- joseph <joseph@ltscommerce.dev>
- Claude Sonnet 4.5 <noreply@anthropic.com>

## Full Changelog

**Compare:** https://github.com/Edmonds-Commerce-Limited/claude-code-hooks-daemon/compare/v2.2.0...v2.2.1
