version: "1.0"

# Daemon configuration
daemon:
  self_install_mode: true    # Enable self-install mode for development
  idle_timeout_seconds: 600  # Auto-shutdown after 10 minutes of inactivity
  log_level: INFO
  enable_hello_world_handlers: false  # Disable test handlers in production

  # Input validation with strict mode (fail-closed)
  input_validation:
    enabled: true      # Enable input validation
    strict_mode: true  # Fail on validation errors (dogfooding requirement)

# Built-in handler configuration
# DOGFOODING: ALL handlers enabled - we use every feature we build
# Handlers run in priority order (lower number = earlier execution)
# Priority ranges: 5=test, 10-20=safety, 25-45=workflow, 50-60=tool usage
handlers:
  # PreToolUse handlers (run before every tool call)
  pre_tool_use:
    # SAFETY HANDLERS (Priority 10-20)
    destructive_git:       # Blocks git reset --hard, git clean -f, etc
      enabled: true
      priority: 10

    sed_blocker:           # Blocks sed command usage (use Edit tool instead)
      enabled: true
      priority: 10

    absolute_path:         # Enforces absolute paths in file operations
      enabled: true
      priority: 12

    worktree_file_copy:    # Prevents copying files between git worktrees
      enabled: true
      priority: 15

    pipe_blocker:          # Blocks expensive commands piped to tail/head
      enabled: true
      priority: 15
      options:
        allowed_pipe_sources:
          - grep          # Text search
          - rg            # Ripgrep
          - awk           # Text processing
          - sed           # Stream editor
          - jq            # JSON processor
          - cut           # Column extraction
          - sort          # Sorting
          - uniq          # Deduplication
          - tr            # Character translation
          - wc            # Word/line count

    git_stash:             # Warns about git stash (stashes can be lost)
      enabled: true
      priority: 20

    # CODE QUALITY HANDLERS (Priority 25-35)
    eslint_disable:        # Prevents ESLint suppression comments
      enabled: true
      priority: 30

    tdd_enforcement:       # Enforces test-first development
      enabled: true
      priority: 35

    python_qa_suppression_blocker:  # Blocks Python QA suppression comments
      enabled: true
      priority: 30

    php_qa_suppression_blocker:     # Blocks PHP QA suppression comments
      enabled: true
      priority: 30

    go_qa_suppression_blocker:      # Blocks Go QA suppression comments
      enabled: true
      priority: 30

    markdown_organization: # Enforces markdown file organization rules (parent handler)
      enabled: true
      priority: 35
      options:
        track_plans_in_project: "CLAUDE/Plan"  # Redirect Claude Code plans to project structure
        plan_workflow_docs: "CLAUDE/PlanWorkflow.md"

    # WORKFLOW HANDLERS (Priority 40-50)
    validate_plan_number:  # Validates plan number format (001-, 002-, etc)
      enabled: true
      priority: 40

    plan_time_estimates:   # Blocks time estimates in plan files
      enabled: true
      priority: 45

    plan_workflow:         # Provides guidance when creating plans
      enabled: true
      priority: 45

    plan_number_helper:    # Helps find correct plan number (child handler)
      enabled: true
      priority: 42
      # Options inherited from markdown_organization (no duplication needed)

    npm_command:           # Restricts npm commands to approved list
      enabled: true
      priority: 50

    gh_issue_comments:     # Helps fetch GitHub issue comments
      enabled: true
      priority: 50

    # TOOL USAGE HANDLERS (Priority 50-60)
    web_search_year:       # Fixes year in web search queries (uses current year)
      enabled: true
      priority: 55

    british_english:       # Warns about American English spelling
      enabled: true
      priority: 60

  # PostToolUse handlers (run after tool execution)
  post_tool_use:
    bash_error_detector:   # Detects errors in bash command output
      enabled: true
      priority: 10

    validate_eslint_on_write:  # Runs ESLint after file writes
      enabled: true
      priority: 20

    validate_sitemap:      # Validates sitemap structure after writes
      enabled: true
      priority: 30

  # SessionStart handlers (run when session starts)
  session_start:
    workflow_state_restoration:  # Restores workflow state after compaction
      enabled: true
      priority: 10

    yolo_container_detection:    # Detects YOLO container environments
      enabled: true
      priority: 40
      options:
        min_confidence_score: 3
        show_detailed_indicators: true
        show_workflow_tips: true

    suggest_status_line:   # Suggests status line setup
      enabled: true
      priority: 55

  # SessionEnd handlers (run when session ends)
  session_end:
    cleanup:               # Cleanup tasks at session end
      enabled: true
      priority: 10

  # PreCompact handlers (run before conversation compaction)
  pre_compact:
    workflow_state_pre_compact:  # Saves workflow state before compaction
      enabled: true
      priority: 10

    transcript_archiver:   # Archives transcripts before compaction
      enabled: true
      priority: 20

  # SubagentStop handlers (run when subagent completes)
  subagent_stop:
    subagent_completion_logger:  # Logs subagent completion
      enabled: true
      priority: 10

    remind_prompt_library: # Reminds about prompt library after agent work
      enabled: true
      priority: 20

    remind_validator:      # Reminds about HTML validation
      enabled: true
      priority: 30

  # UserPromptSubmit handlers (run when user submits prompt)
  user_prompt_submit:
    git_context_injector:  # Injects git context into prompts
      enabled: true
      priority: 10

  # PermissionRequest handlers (run on permission requests)
  permission_request:
    auto_approve_reads:    # Auto-approves read-only operations
      enabled: true
      priority: 10

  # Notification handlers (run on notifications)
  notification:
    notification_logger:   # Logs notifications
      enabled: true
      priority: 10

  # Stop handlers (run when session stops)
  stop:
    task_completion_checker:  # Checks for incomplete tasks
      enabled: true
      priority: 10

    auto_continue_stop:    # Handles auto-continue on stop
      enabled: true
      priority: 20

  # Status line handlers (provide custom status line display)
  status_line:
    git_repo_name:         # Shows repository name at start (cached)
      enabled: true
      priority: 3

    account_display:       # Shows Claude account username
      enabled: true
      priority: 5

    model_context:         # Shows model name and context percentage
      enabled: true
      priority: 10

    usage_tracking:        # Shows daily/weekly token usage percentages
      enabled: true
      priority: 15
      options:
        show_daily: true
        show_weekly: true

    git_branch:            # Shows current git branch
      enabled: true
      priority: 20

    daemon_stats:          # Shows daemon uptime and stats
      enabled: true
      priority: 30

# Project-level handlers (custom handlers in .claude/hooks/handlers/)
plugins:
  paths: []
  plugins: []
