version: "2.0"

# Daemon configuration
daemon:
  idle_timeout_seconds: 600  # Auto-shutdown after 10 minutes of inactivity
  log_level: INFO
  self_install_mode: true  # Self-install: daemon runs from project root (not .claude/hooks-daemon/)
  strict_mode: true  # FAIL FAST on ALL errors (dogfooding requirement)

  enable_hello_world_handlers: false  # Disabled - using real handlers instead

  # Input validation (v2.2.0+) - Catch malformed events at front controller layer
  input_validation:
    enabled: true              # Validate hook inputs (recommended)
    strict_mode: true          # Fail-closed: return errors on validation failures
    log_validation_errors: true

# Built-in handler configuration
# Handlers run in priority order (lower number = earlier execution)
# Priority ranges: 5=test, 10-20=safety, 25-45=workflow, 50-60=tool usage
handlers:
  # PreToolUse handlers (run before every tool call)
  pre_tool_use:
    # TESTING HANDLERS (Priority 5)
    hello_world_pre_tool_use:  # Test handler showing hook is working
      enabled: false                     # Disabled - using real handlers
      priority: 5

    # SAFETY HANDLERS (Priority 10-20)
    destructive_git:       # Blocks git reset --hard, git clean -f, etc
      enabled: true
      priority: 10

    sed_blocker:           # Blocks sed command usage (use Edit tool instead)
      enabled: true
      priority: 11

    absolute_path:         # Enforces absolute paths in file operations
      enabled: true
      priority: 12

    worktree_file_copy:    # Prevents copying files between git worktrees
      enabled: true
      priority: 15

    curl_pipe_shell:       # Blocks dangerous curl | sh patterns
      enabled: true
      priority: 16

    pipe_blocker:          # Blocks dangerous pipe patterns in bash commands
      enabled: true
      priority: 17

    dangerous_permissions: # Warns about dangerous file permission changes
      enabled: true
      priority: 18

    git_stash:             # Warns about git stash (stashes can be lost)
      enabled: true
      priority: 19

    lock_file_edit_blocker: # Prevents editing package lock files
      enabled: true
      priority: 20

    pip_break_system:      # Blocks pip commands that break system packages
      enabled: true
      priority: 21

    sudo_pip:              # Blocks sudo pip (use venv instead)
      enabled: true
      priority: 22

    daemon_restart_verifier: # Verifies daemon restart after code changes
      enabled: true
      priority: 23

    # CODE QUALITY HANDLERS (Priority 25-45)
    qa_suppression:        # Unified multi-language QA suppression blocker (11 languages)
      enabled: true
      priority: 30
      # options:
      #   # Restrict QA suppression enforcement to specific languages (default: ALL languages)
      #   # Uncomment and list only the languages you want enforced.
      #   # If omitted or empty, ALL 11 languages are enforced.
      #   languages:
      #     - Python
      #     - Go
      #     - JavaScript/TypeScript
      #     - PHP

    tdd_enforcement:       # Enforces test-first development
      enabled: true
      priority: 35
      # options:
      #   # Restrict TDD enforcement to specific languages (default: ALL languages)
      #   # Uncomment and list only the languages you want enforced.
      #   # If omitted or empty, ALL 11 languages are enforced.
      #   languages:
      #     - Python
      #     - Go
      #     - JavaScript/TypeScript
      #     - PHP
      #     - Rust
      #     - Java
      #     - C#
      #     - Kotlin
      #     - Ruby
      #     - Swift
      #     - Dart

    # WORKFLOW HANDLERS (Priority 30-50)
    plan_number_helper:    # Provides correct next plan number (prevents broken bash discovery)
      enabled: true        # Enable when using CLAUDE/Plan/ structure
      priority: 33
      options:
        track_plans_in_project: "CLAUDE/Plan"  # Must match markdown_organization setting

    task_tdd_advisor:      # Advises on TDD workflow for tasks
      enabled: true
      priority: 36

    gh_issue_comments:     # Requires --comments flag for gh issue view
      enabled: true
      priority: 40

    validate_plan_number:  # Validates plan number format (001-, 002-, etc)
      enabled: true        # Enable for projects using CLAUDE/Plan/
      priority: 41

    global_npm_advisor:    # Advises against global npm installs
      enabled: true
      priority: 42

    plan_time_estimates:   # Blocks time estimates in plan files
      enabled: true        # Enable for projects using CLAUDE/Plan/
      priority: 45

    plan_workflow:         # Provides guidance when creating plans
      enabled: true        # Enable for projects using CLAUDE/Plan/
      priority: 46

    plan_completion_advisor: # Advises on plan completion workflow
      enabled: true
      priority: 48

    npm_command:           # Restricts npm commands to approved list
      enabled: true        # Enable for strict npm usage control
      priority: 49

    markdown_organization: # Enforces markdown file organization rules & plan tracking
      enabled: true        # Enable for md organization + plan tracking
      priority: 50
      # Docs: docs/guides/handlers/markdown_organization.md
      options:
        track_plans_in_project: "CLAUDE/Plan"     # Path to plan folder (null to disable)
        plan_workflow_docs: "CLAUDE/PlanWorkflow.md"  # Optional: workflow doc to reference
        # allowed_markdown_paths: OVERRIDES all built-in path rules with custom regex.
        # In monorepos, patterns match AFTER prefix stripping. See HANDLER_REFERENCE.md.
        #   allowed_markdown_paths:
        #     - "^CLAUDE/.*\\.md$"
        #     - "^docs/.*\\.md$"
        #     - "^untracked/.*\\.md$"
        #     - "^RELEASES/.*\\.md$"
        #     - "^eslint-rules/.*\\.md$"
        #     - "^src/claude_code_hooks_daemon/guides/.*\\.md$"

    # TOOL USAGE HANDLERS (Priority 50-60)
    web_search_year:       # Fixes year in web search queries (uses current year)
      enabled: true
      priority: 55

    british_english:       # Warns about American English spelling
      enabled: true
      priority: 60

  # PostToolUse handlers (run after tool execution)
  post_tool_use:
    bash_error_detector:   # Detects bash errors and suggests corrections
      enabled: true
      priority: 10

    validate_eslint_on_write:  # Runs ESLint after file writes
      enabled: true            # Enable for automatic ESLint validation
      priority: 20

    lint_on_edit:              # Language-aware lint validation after Write/Edit
      enabled: true
      priority: 25
      # Optional: Override lint commands per language
      # command_overrides:
      #   Python:
      #     default: "/usr/bin/python3.11 -m py_compile {file}"  # Custom Python path
      #     extended: "ruff check {file}"
      #   Shell:
      #     default: "bash -n {file}"
      #     extended: null  # Disable shellcheck
      # Default: Uses sys.executable for Python, standard binaries for others

  # SessionStart handlers (run when session starts)
  session_start:
    yolo_container_detection:  # Detects YOLO development environments (Docker, etc)
      enabled: true
      priority: 10

    optimal_config_checker:  # Checks Claude Code env for optimal settings
      enabled: true
      priority: 52

    suggest_status_line:  # Suggests daemon-based status line setup
      enabled: true      # Enable to suggest status line configuration
      priority: 55

    version_check:  # Checks if daemon is up-to-date with latest release
      enabled: true  # Notifies on new sessions if updates available (24h cache)
      priority: 56

    workflow_state_restoration:  # Restores workflow state after compaction
      enabled: true              # Enable for workflow state management
      priority: 60

  # PreCompact handlers (run before conversation compaction)
  pre_compact:
    transcript_archiver:  # Archives transcripts before compaction
      enabled: true
      priority: 10

    workflow_state_pre_compact:  # Saves workflow state before compaction
      enabled: true              # Enable for workflow state management
      priority: 20

  # SessionEnd handlers (run when session ends)
  session_end:
    cleanup:  # Session cleanup operations
      enabled: true
      priority: 10

  # SubagentStop handlers (run when subagent completes)
  subagent_stop:
    subagent_completion_logger:  # Logs subagent completion
      enabled: true
      priority: 10

    remind_prompt_library:  # Reminds about prompt library after agent work
      enabled: true         # Enable for prompt library reminders
      priority: 20

  # UserPromptSubmit handlers (run when user submits prompt)
  user_prompt_submit:
    git_context_injector:  # Injects git context into user prompts
      enabled: true
      priority: 10

    critical_thinking_advisory:  # Periodic advisory encouraging critical evaluation
      enabled: true
      priority: 55

    # auto_continue:  # Auto-continues on 'continue' keyword
    #   enabled: false # Optional - enable for auto-continue behavior
    #   priority: 20

  # Other hook events
  permission_request:
    auto_approve_reads:  # Auto-approves read-only file operations
      enabled: true
      priority: 10

  notification:
    notification_logger:  # Logs notifications
      enabled: true
      priority: 10

  stop:
    auto_continue_stop:  # Auto-continues after stop events based on criteria
      enabled: true
      priority: 10

    hedging_language_detector:  # Detects guessing language (should probably, IIRC, I believe, etc)
      enabled: true
      priority: 30

    task_completion_checker:  # Checks for task completion
      enabled: true
      priority: 20

  # Status line handlers (format daemon-based status display)
  status_line:
    model_context:  # Shows model name and color-coded context percentage
      enabled: true
      priority: 10

    git_branch:     # Shows current git branch if in repo
      enabled: true
      priority: 20

    git_repo_name:  # Shows git repository name
      enabled: true
      priority: 25

    daemon_stats:   # Shows daemon uptime, memory, log level
      enabled: true
      priority: 30

    account_display: # Shows account information
      enabled: true
      priority: 40

    thinking_mode:  # Shows current thinking mode
      enabled: true
      priority: 12

    current_time:   # Shows current local time (24-hour format)
      enabled: true
      priority: 14

    usage_tracking: # Tracks and displays usage statistics
      enabled: true
      priority: 60

# Project-level handlers (custom handlers in .claude/hooks/handlers/)
plugins:
  paths: [".claude/hooks/handlers/session_start"]
  plugins:
    - path: dogfooding_reminder
      event_type: session_start
      enabled: true
      priority: 35

project_handlers:
  enabled: true
  path: .claude/project-handlers
